# Restaurant System Microservices

A simple restaurant ordering system built with **Node.js 20** and **NestJS**, using a microservices architecture:

- **Order Service** ‚Äì REST API to fetch menu, place orders, track orders  
- **Kitchen Service** ‚Äì background consumer that processes orders  
- **Notification Service** ‚Äì background consumer that ‚Äúsends‚Äù email confirmations (logs)

Components communicate via a **RabbitMQ** fan-out exchange. Data is stored in **MongoDB**. Services are containerized with **Docker** (Node 20, Alpine) and orchestrated via **Docker Compose** (cross-platform: x86/x64 & ARM64).

---

## üì¶ Prerequisites

- **Node.js 20** & **npm**  
- **Docker** & **Docker Compose**  
- (optional) **Nest CLI**: `npm install -g @nestjs/cli`

---

## üîß Environment Variables

Each service reads:

```dotenv
# common
RABBITMQ_URL=amqp://rabbitmq

# order-service & kitchen-service
MONGO_URI=mongodb://mongodb:27017/orders
```

Copy `.env.example` to `.env` in each service folder and adjust if needed.

---

## ‚ú® Quick Start

```bash
# clone repo
git clone https://github.com/your-org/restaurant-system.git
cd restaurant-system

# bring up Mongo, RabbitMQ, and all services
docker-compose up --build
```

- **Order Service**:  http://localhost:3001  
- **RabbitMQ Management**: http://localhost:15672  (guest/guest)  

---

## üîç Service Details

### 1. Order Service

- **Port**: `3001`  
- **DB**: MongoDB `orders` database  
- **RabbitMQ Exchange**: `order_exchange` (fanout)  

#### Endpoints

| Method | Path         | Description                 | Status Code |
| ------ | ------------ | --------------------------- | ----------- |
| GET    | `/menu`      | Fetch all menu items        | 200         |
| POST   | `/order`     | Place a new order           | 201         |
| GET    | `/order/:id` | Track order by ID           | 200 (or 404) |

**Example**:

```bash
# fetch menu
curl http://localhost:3001/menu

# place order
curl -X POST http://localhost:3001/order \
  -H "Content-Type: application/json" \
  -d '{"customerEmail":"alice@example.com","menuItems":["Burger","Salad"]}'

# track order
curl http://localhost:3001/order/<orderId>
```

---

### 2. Kitchen Service

- **Type**: Background NestJS application  
- **Function**:
  1. Consume from `order.process` queue  
  2. Update the corresponding Order document‚Äôs `status` to `Processed`  

Launched via `main.ts` with `NestFactory.createApplicationContext()`. No HTTP server.

---

### 3. Notification Service

- **Type**: Background NestJS application  
- **Function**:
  1. Consume from `order.confirmation` queue  
  2. ‚ÄúSend‚Äù an email by logging `Email sent to <customerEmail> for order <orderId>`  

Also runs headlessly.

---

## üê≥ Docker & Docker Compose

- **Dockerfiles** use `node:20-alpine`  
- **Compose services**:
  - `mongodb` (image: `mongo`)
  - `rabbitmq` (image: `rabbitmq:3-management`)
  - `order-service`
  - `kitchen-service`
  - `notification-service`

```yaml
services:
  mongodb:
    image: mongo
    ports: ["27017:27017"]
  rabbitmq:
    image: rabbitmq:3-management
    ports: ["5672:5672","15672:15672"]
  order-service:
    build: ./order-service
    ports: ["3001:3001"]
    env_file: ./order-service/.env
    depends_on: [mongodb, rabbitmq]
  kitchen-service:
    build: ./kitchen-service
    env_file: ./kitchen-service/.env
    depends_on: [mongodb, rabbitmq]
  notification-service:
    build: ./notification-service
    env_file: ./notification-service/.env
    depends_on: [rabbitmq]
```

---

## üõ†Ô∏è Database Seeding

After MongoDB is up, insert sample menu:

```bash
docker exec -it <mongo-container> mongo orders \
  --eval 'db.menus.insertMany([
    {name:"Burger",price:50},
    {name:"Pizza",price:75},
    {name:"Salad",price:30}
  ])'
```

---

## üìä Testing

Each service includes Jest tests (generated by Nest CLI):

```bash
# from each service folder
npm run test           # unit tests
npm run test:watch     # watch mode
npm run test:cov       # coverage
```

Tests cover controllers, services, and the RabbitMQ helper‚Äôs basic behavior.

---

## üìñ Documentation & Contributing

- **Documentation**: this README + inline code comments  
- **To run locally without Docker**:
  1. `cd order-service && npm install && npm run start:dev`  
  2. Ensure MongoDB & RabbitMQ are running locally  
  3. Repeat for other services  

---